# Migration Tool

This migration tool should support the migration process between versions of applications.
With the migration tool steps that are based of bash scripts can be defined and orchestrated. 

# Usage

The documentation of the Available commands and flags can be found [here](docs/cli/migration-tool.md).

## Run with Docker
```bash
docker run -v ./examples/migrations:/migrations -v ./output:/output ghcr.io/christophbe/migration-tool:latest -execution-filename ./output/execution-log.yaml run
```

## Migrations File

The `migrations.yaml` file should be structured as follows:
```yaml
migrations:
  - filename: 001_first_step.sh
    description: |
      Execute step one of the migrations.
    hash: <auto-generated>
  - filename: 002_second_step.sh
    description: |
      Execute step two of the migrations.
    hash: <auto-generated>
```

# Development

## Setup
1. Clone this Repository
2. Install needed development tooling.
   - [Golang CLI](https://go.dev/dl) Version 1.24 or later
   - [mockery](https://vektra.github.io/mockery/latest/installation/) for generation of mocks
   - (optional) [cobra-cli](https://github.com/spf13/cobra/tree/main?tab=readme-ov-file#usage) cobra-cli for generation code for new command

## Run and Build 
### Run from Code 
```bash
go run  github.com/ChristophBe/migration-tool/cmd/migration-tool
```

### Build executable
```bash
go build  github.com/ChristophBe/migration-tool/cmd/migration-tool
```

## Run Tests
```bash
go test ./...
```

## Generate Code
For testing mock implementations of interfaces are used. To generate the mocks [mockery](https://vektra.github.io/mockery/latest/) is used.
In addition to mock the documentation, for usage of the CLIs also gets generated.

To run regenerate the generated files run the following command:
```bash
go generate
```